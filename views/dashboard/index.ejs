<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - Race Weekend Planner</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('../partials/navbar') %>

    <div class="container">
        <h1 class="welcome-title">Welcome back, <%= user.username %>! üèÅ</h1>
       
        <% if (nextRace) { %>
            <div class="next-race-card">
                <h2 class="section-title">üè¥ NEXT RACE</h2>
                
                <h3 class="race-name"><%= nextRace.name %></h3>
                <p class="race-date"><%= nextRace.date.toDateString() %></p>
                <p class="race-info"><%= nextRace.circuit %></p>
                
                <% if (countdown) { %>
                    <p class="countdown">‚è±Ô∏è <%= countdown %></p>
                <% } %>
                
                <div class="button-group">
                    <% if (userPrediction) { %>
                        <a href="/predictions/<%= userPrediction._id %>/edit" class="btn-primary">Edit Prediction</a>
                        <a href="/races/<%= nextRace._id %>" class="btn-secondary">View Race Details</a>
                    <% } else { %>
                        <a href="/races/<%= nextRace._id %>/predictions/new" class="btn-primary">Make Predictions</a>
                        <a href="/races/<%= nextRace._id %>" class="btn-secondary">View Race Details</a>
                    <% } %>
                </div>
            </div>
        <% } else { %>
            <div class="next-race-card">
                <h2 class="section-title">üè¥ NEXT RACE</h2>
                <p>No upcoming races</p>
            </div>
        <% } %>

        <div class="predictions-card">
            <h2 class="section-title">YOUR PREDICTIONS</h2>
            
            <% if (recentPredictions.length > 0) { %>
                <div class="predictions-list">
                    <% recentPredictions.slice(0, 3).forEach(prediction => { %>
                        <div class="prediction-item">
                            <h4><%= prediction.raceId ? prediction.raceId.name : 'Unknown Race' %></h4>
                            <% if (prediction.raceId && prediction.raceId.status === 'completed') { %>
                                <span class="prediction-points">Points: <%= prediction.points || 0 %></span>
                            <% } else { %>
                                <span class="prediction-status">‚úÖ Prediction submitted</span>
                            <% } %>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <p>No predictions made yet. <a href="/races">View races to get started!</a></p>
            <% } %>
        </div>
    </div>

</body>
</html>